<ion-header [translucent]="true">
  <!-- Selection mode header -->
  <ion-toolbar class="arch-toolbar" *ngIf="selected.length > 0; else normalHeader">
    <ion-buttons slot="start">
      <ion-button (click)="clearSelection()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>{{ selected.length }}</ion-title>

    <ion-buttons slot="end">
      <!-- Delete only when ONLY privates are selected -->
      <ion-button *ngIf="selectionMeta.onlyPrivates" (click)="deleteSelected()">
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>

      <!-- Unarchive is always available -->
      <ion-button (click)="unarchiveSelected()">
        <ion-icon name="archive-outline"></ion-icon>
      </ion-button>

      <ion-button (click)="openArchiveMenu($event)">
        <ion-icon name="ellipsis-vertical"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Normal header -->
  <ng-template #normalHeader>
    <ion-toolbar class="arch-toolbar">
      <ion-buttons slot="start">
        <ion-back-button defaultHref="/home"></ion-back-button>
      </ion-buttons>
      <ion-title>Archived</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="openArchiveMenu($event)">
          <ion-icon name="ellipsis-vertical"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ng-template>

  <!-- ðŸ”´ Always-visible banner (moved outside the conditional headers) -->
  <ion-toolbar class="arch-banner">
    <div class="banner-text">
      These chats stay archived when new messages are received.
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="arch-content">
  <!-- Loader -->
  <ion-list *ngIf="isLoading">
    <ion-item *ngFor="let i of [1,2,3]">
      <ion-avatar slot="start">
        <ion-skeleton-text animated style="width:40px;height:40px;border-radius:50%"></ion-skeleton-text>
      </ion-avatar>
      <ion-label>
        <h3><ion-skeleton-text animated style="width:60%"></ion-skeleton-text></h3>
        <p><ion-skeleton-text animated style="width:80%"></ion-skeleton-text></p>
      </ion-label>
    </ion-item>
  </ion-list>

  <!-- List -->
  <ion-list *ngIf="!isLoading">
    <ion-item *ngFor="let it of items" [class.selected]="isSelected(it)" (click)="onRowClick(it, $event)"
      (touchstart)="startLongPress(it)" (touchend)="cancelLongPress()" (touchmove)="cancelLongPress()">
      <div class="chat-item">
        <div slot="start" class="select-tick" *ngIf="selected.length > 0" (click)="toggleSelection(it, $event)">
          <ion-icon [name]="isSelected(it) ? 'checkmark-circle' : 'ellipse-outline'"></ion-icon>
        </div>

        <ion-avatar (click)="selected.length ? toggleSelection(it, $event) : null">
          <img *ngIf="it.avatar; else initials" [src]="it.avatar" alt="avatar" />
          <ng-template #initials>
            <div class="avatar-fallback">{{ (it.title||'?').slice(0,1) }}</div>
          </ng-template>
        </ion-avatar>

        <ion-label>
          <h3 class="name">{{ it.title }}</h3>
          <p class="preview">{{ it.lastMessage }}</p>
        </ion-label>

        <div class="meta">
          <div class="time">{{ it.lastMessageAt | date: 'shortTime' }}</div>
          <ion-badge *ngIf="(it?.unreadCount||0) > 0" color="danger">{{ it?.unreadCount }}</ion-badge>

        </div>
      </div>
    </ion-item>

    <ion-item *ngIf="!items.length" lines="none">
      <ion-label class="empty">No archived chats</ion-label>
    </ion-item>
  </ion-list>
</ion-content>